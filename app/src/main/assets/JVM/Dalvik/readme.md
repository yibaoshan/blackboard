

## Dalvik 简介


Dalvik 是 Google 专门为 Android 操作系统开发的虚拟机。

它支持.dex（即“Dalvik Executable”）格式的 Java 应用程序的运行。


.dex格式是专为Dalvik设计的一种压缩格式，适合内存和处理器速度有限的系统。

Dalvik由 Dan Bornstein 编写，名字来源于他的祖先曾经居住过的小渔村达尔维克（Dalvík），位于冰岛。


## 栈 VS 寄存器

大多数虚拟机都是基于 "**堆栈架构**" 的，例如 HotSpot JVM。

然而 **Dalvik** 虚拟机却恰好不是，它是基于 **寄存器架构** 的虚拟机。

两者的区别是，一个是操作 "**栈内存**"，一个是操作 "**寄存器内存**"，各有自己的优缺点

###  基于栈的优缺点

- 优点，指令简单，只需要使用 CPU 的读取指令，执行指令，传送结果就行了。不需要把值保存到 CPU 的某个寄存器中
- 优点，对 CPU 的要求少一点，不过当下无需考虑到这点

### 基于寄存器的优缺点

- 优点，指令数量减少，执行速度快
- 缺点，可能需要适配各个指令集


对于基于栈的虚拟机来说，每一个运行时的线程，都有一个独立的栈。

栈中记录了方法调用的历史，每有一次方法调用，栈中便会多一个 **栈桢**。

最顶部的栈桢称作 **当前栈桢**，其代表着当前执行的方法。栈桢中通常包含四个信息：

- 局部变量：方法参数和方法中定义的局部变量
- 操作数栈：后入先出的栈
- 动态连接：指向运行时常量池该栈桢所属方法的引用
- 返回地址：当前方法的返回地址

基于堆栈架构的虚拟机的执行过程，就是不断在操作数栈上操作的过程。

例如，对于计算“1+1”的结果这样一个计算，基于栈的虚拟机需要先将这两个数压入栈，然后通过一条指针对栈顶的两个数字进行加法运算，然后再将结果存储起来。

而对于基于寄存器的虚拟机来说执行过程是完全不一样的。

该类型虚拟机会将运算的参数放至寄存器中，然后在寄存器上直接进行运算。

