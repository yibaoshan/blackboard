
### Java 虚拟机


Java虚拟机（Java Virtual Machine，缩写为JVM）是一种能够运行 Java bytecode 的虚拟机，以 **"堆栈结构"** 来进行操作。


JVM有三个概念：**规范**，**实现** 和 **实例** 。


- 规范是一个正式描述 JVM 实现所需要的文档，具有单个规范确保所有实现是可互操作的。
- JVM 实现是一种满足 JVM 规范要求的计算机程序。
- JVM 的实例是在执行编译成 Java 字节码的计算机程序的过程中运行的实现。

Java 虚拟机有自己完善的硬体架构，如处理器、堆栈、寄存器等，还具有相应的指令系统。


JVM屏蔽了与具体操作系统平台相关的信息，使得 Java 程序只需生成在 Java 虚拟机上运行的目标代码（字节码），就可以在多种平台上不加修改地运行。

Java 虚拟机并不知道 Java 编程语言，只知道一个特定的二进制格式：**class 文件格式**


class 文件包含了 Java 虚拟机的指令（或字节码）和符号表，以及其他辅助信息。


### HotSpot

HotSpot 是我们最为熟悉的 Java 虚拟机实现。因为这是 Sun JDK 以及 OpenJDK 中所带的虚拟机。


HotSpot 虚拟机的实现包含如下几个组成部分：

- 类加载器子系统：负责加载和验证class文件
- 运行时数据区：JVM运行时的内存资源，运行时数据区可以分为以下几个部分：
  - 方法区：存储了类代码和方法代码
  - 堆：通过new创建的对象都在堆中分配
  - Java线程栈：一个 Java 程序可以创建了多个线程，每个线程都会有自己的栈
  - 程序计数寄存器：存储了执行指令的内存地址
  - 本地方法栈：本地方法（例如：C/C++语言）执行的区域
- 执行引擎：执行引擎是真正运行Java代码的模块，它包括了：
  - JIT（Just-In-Time）编译器：负责将字节码转换为机器码
  - 垃圾收集器：负责回收不再使用的对象
- 本地方法接口：运行虚拟机与本地方法互相调用
- 本地方法库：包含了本地库的信息


需要注意的是，HotSpot 并非唯一的 JVM 实现，目前市面上还有很多其他公司和组织实现的Java虚拟机，例如BEA JRockit，IBM J9等。

### 参考资料

- [Java虚拟机与垃圾回收算法](https://paul.pub/android-java-vm/)